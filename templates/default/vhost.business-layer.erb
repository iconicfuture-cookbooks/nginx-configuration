server {
  listen <%= node['nginx']['port'] %>;
  server_name <%= @config['fqdn'] %>;

  access_log <%= node['nginx']['log_dir'] %>/<%= @config['fqdn'] %>.access.log;
  error_log <%= node['nginx']['log_dir'] %>/<%= @config['fqdn'] %>.error.log;


  root /var/www/<%= @config['fqdn'] %>/silex/public/;

  index <%= @config['nginx']['index_file'] %>;

  error_page  404 405 = <%= @config['nginx']['index_file'] %>;

  client_max_body_size <%= @config['nginx']['client_max_body_size'] %>;

  location / {
      try_files $uri $uri/ <%= @config['nginx']['index_file'] %>?$args;
  }

  location ~ .(php|phtml)$ {
    fastcgi_pass <%= @config['nginx']['fastcgi_pass'] %>;
    fastcgi_index <%= @config['nginx']['index_file'] %>;
    fastcgi_param PHP_VALUE "newrelic.appname=Local <%= @config['nginx']['appname'] %>";
    fastcgi_buffers 16 16k;
    fastcgi_buffer_size 32k;
    fastcgi_connect_timeout <%= @config['nginx']['fastcgi_connect_timeout'] %>;
    fastcgi_read_timeout <%= @config['nginx']['fastcgi_read_timeout'] %>;
    include fastcgi_params;
  }
}
